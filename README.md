# CrackHash

## Предисловие
Проект CrackHash нацелен на создание распределённой системы для взлома MD5-хэшей посредством перебора (brute-force) словаря, сформированного на основе заданного алфавита. Система построена по принципу разделения ответственности между двумя основными компонентами: **менеджером** и **воркерами**.

## Архитектура системы

### Менеджер
Менеджер отвечает за:
- Приём запросов от пользователей, содержащих MD5-хэш и максимальную длину исходного слова.
- Генерацию задач для воркеров, распределяя диапазон перебора слов на основе значений `PartNumber` и `PartCount`. Это позволяет равномерно делить всё пространство слов между воркерами.
- Сохранение состояния запроса в оперативной памяти с использованием потокобезопасных коллекций.
- Отправку задач воркерам по протоколу HTTP, используя формат XML для передачи данных.
- Обработку ответов от воркеров и обновление статуса запроса. Если все воркеры отдали ответы — статус меняется на `READY`, если один или несколько не ответили — на `PARTIAL_READY`, а при возникающей ошибки — на `ERROR`.

#### REST API менеджера
- **Запрос на взлом хэша:**
    - **Метод:** POST
    - **Путь:** `/api/hash/crack`
    - **Тело запроса (JSON):**
      ```json
      {
          "hash": "e2fc714c4727ee9395f324cd2e7f331f",
          "maxLength": 4
      }
      ```
    - **Ответ (JSON):**
      ```json
      {
          "requestId": "730a04e6-4de9-41f9-9d5b-53b88b17afac"
      }
      ```
- **Получение статуса задачи:**
    - **Метод:** GET
    - **Путь:** `/api/hash/status?requestId=730a04e6-4de9-41f9-9d5b-53b88b17afac`
    - **Возможные ответы:**
        - Если задача ещё выполняется:
          ```json
          {
              "status": "IN_PROGRESS",
              "data": null
          }
          ```
        - Если задача успешно выполнена:
          ```json
          {
              "status": "READY",
              "data": ["abcd"]
          }
          ```

### Воркеры
Воркеры получают задачи от менеджера и отвечают за:
- Перебор слов в заданном диапазоне, вычисление их MD5-хэшей и сравнение с полученным хэшем.
- Возврат найденных результатов менеджеру.

#### API взаимодействия
- **От менеджера к воркеру:**
    - **Метод:** POST
    - **Путь:** `/internal/api/worker/hash/crack/task`
    - **Формат передачи:** XML (структура запроса генерируется на основе XSD-схемы)

- **От воркера к менеджеру:**
    - **Метод:** PATCH
    - **Путь:** `/internal/api/manager/hash/crack/request`
    - **Формат передачи:** XML (ответ формируется согласно XSD-схеме)

### Генерация слов
Для перебора возможных слов используется генерация комбинаций с повторениями из заданного алфавита, который состоит из строчных латинских букв и цифр. Важно, чтобы:
- Перебор осуществлялся итеративно, без необходимости загрузки всех комбинаций в память, что критически при увеличении максимальной длины слова.
- Расчёт диапазона слов проводился на основе параметров `PartNumber` и `PartCount`, позволяющих равномерно распределить вычислительную нагрузку между воркерами.

## Возможные статусы задачи
- **NEW** — задача ещё не начата.
- **IN_PROGRESS** — задача находится в процессе выполнения.
- **READY** — задача выполнена успешно.
- **ERROR** — произошла ошибка при выполнении.
- **PARTIAL_READY** — один или несколько воркеров не вернули ответ.

## Взаимодействие компонентов
- **Передача задач:** Менеджер генерирует и отправляет задачи воркерам по HTTP в формате JSON.
- **Обработка результатов:** После получения ответов от всех воркеров менеджер обновляет статус запроса. Если не все воркеры ответили в установленный таймаут, статус изменяется на `ERROR` или `PARTIAL_READY`.
- **Хранение состояния:** Информация о каждом запросе хранится в оперативной памяти с использованием потокобезопасных структур данных.

## Конфигурация и запуск

### Файл конфигурации
Все настройки для работы сервисов расположены в файле `config.kdl`.

### Запуск через Docker Compose
Для сборки и запуска сервисов выполните следующие шаги:
1. Убедитесь, что на вашей машине установлены [Docker](https://www.docker.com/) и [Docker Compose](https://docs.docker.com/compose/).
2. Перейдите в корневую директорию проекта, где находится файл `docker-compose.yml`.
3. Запустите команду сборки и старта сервисов:
   ```bash
   docker-compose up --build